# .github/workflows/preprocess.yml - UPDATE VERSION
name: Data Preprocessing Pipeline

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  preprocess:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
      
    - name: Debug - Show Repository Structure
      run: |
        echo "=== CURRENT DIRECTORY ==="
        pwd
        echo -e "\n=== ALL FILES ==="
        find . -type f | head -30
        echo -e "\n=== Diabetes_prediction_dataset_raw FOLDER ==="
        ls -la Diabetes_prediction_dataset_raw/ 2>/dev/null || echo "Folder not found!"
        echo -e "\n=== preprocessing FOLDER ==="
        ls -la preprocessing/
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'
        
    - name: Install Dependencies
      run: |
        pip install pandas numpy scipy scikit-learn
        
    - name: Run Preprocessing
      run: |
        echo "=== RUNNING PREPROCESSING ==="
        echo "Current directory: $(pwd)"
        echo "Input file path: Diabetes_prediction_dataset_raw/diabetes_prediction_dataset.csv"
        
        # Cek file exists
        if [ -f "Diabetes_prediction_dataset_raw/diabetes_prediction_dataset.csv" ]; then
          echo "✓ Input file found!"
          echo "File size: $(wc -l < Diabetes_prediction_dataset_raw/diabetes_prediction_dataset.csv) lines"
        else
          echo "✗ ERROR: Input file NOT found!"
          echo "Listing Diabetes_prediction_dataset_raw folder:"
          ls -la Diabetes_prediction_dataset_raw/ 2>/dev/null || echo "Folder doesn't exist"
          exit 1
        fi
        
        python preprocessing/automate_RiaDwiRatna.py \
          --input Diabetes_prediction_dataset_raw/diabetes_prediction_dataset.csv \
          --output preprocessing/diabetes_preprocessed_full.csv
          
    - name: Display Results
      run: |
        echo "=== RESULTS ==="
        if [ -f "preprocessing/diabetes_preprocessed_full.csv" ]; then
          echo "✓ Output file created successfully!"
          echo "File size: $(wc -l < preprocessing/diabetes_preprocessed_full.csv) lines"
          echo "First 2 rows:"
          head -n 2 preprocessing/diabetes_preprocessed_full.csv | cut -d',' -f1-5
        else
          echo "✗ ERROR: Output file not created!"
        fi